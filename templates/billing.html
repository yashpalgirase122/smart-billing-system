{% extends "base.html" %}
{% block title %}Billing{% endblock %}

{% block content %}

<!-- ================= BILLING FORM ================= -->
<div class="card">
  <h2>üßæ Billing</h2>

  <form method="POST" class="billing-form">

    <!-- üë§ Customer -->
    <input type="text" name="customer" placeholder="Customer Name" required>

    <!-- üßæ Product -->
    <input type="text" name="product" placeholder="Product Name" required>

    <input type="number" name="qty" placeholder="Quantity" required>
    <input type="number" step="0.01" name="sell" placeholder="Sell Price" required>
    <input type="number" step="0.01" name="buy" placeholder="Buy Price" required>

    <!-- üí∞ Outstanding Balance -->
    <input type="number"
           step="0.01"
           name="outstanding"
           placeholder="Outstanding Balance (if any)"
           value="0">

    <!-- üìÖ Bill Date -->
    <input type="date" name="date" value="{{ today }}" required>

    <button type="submit" class="btn">Save Bill</button>
  </form>
</div>

<!-- ================= CUSTOMER SEARCH ================= -->
<div class="card">
  <h3>üîç Search Customer</h3>

  <form method="GET" action="{{ url_for('customer_search') }}">
    <input type="text"
           name="customer"
           placeholder="Search customer name..."
           required>
    <button type="submit" class="btn">Search</button>
  </form>
</div>

<!-- ================= SALES RECORDS ================= -->
<div class="card">
  <h3>üìä Sales Records</h3>

  <table>
    <tr>
      <th>Customer</th>
      <th>Product</th>
      <th>Qty</th>
      <th>Sell</th>
      <th>Buy</th>
      <th>Total</th>
      <th>Profit / Loss</th>
      <th>Outstanding</th>
      <th>Date</th>
      <th>Action</th>
    </tr>

    {% for s in sales %}
    <tr>
      <td>
        <a href="{{ url_for('customer_history', name=s.customer) }}">
          {{ s.customer }}
        </a>
      </td>

      <td>{{ s.product }}</td>
      <td>{{ s.quantity }}</td>
      <td>{{ s.sell_price }}</td>
      <td>{{ s.buy_price }}</td>
      <td>{{ s.total }}</td>

      <!-- ‚úÖ PROFIT / LOSS (NO CSS ERROR) -->
      <td class="{% if s.profit < 0 %}loss{% else %}profit{% endif %}">
        {{ s.profit }}
      </td>

      <!-- Outstanding -->
      <td class="outstanding">
        {{ s.outstanding_balance }}
      </td>

      <td>{{ s.date }}</td>

      <td>
        <a href="{{ url_for('print_bill', bill_id=s.id) }}" class="btn btn-sm">
          üßæ PDF
        </a>
      </td>
    </tr>
    {% endfor %}
  </table>
</div>

{% endblock %}
